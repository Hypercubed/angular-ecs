/**
 * angular-ecs
 * @version v0.0.8 - 2015-03-31
 * @link https://github.com/Hypercubed/angular-ecs
 * @author Jayson Harshbarger <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";window.performance=window.performance||{},window.performance.now=function(){return window.performance.now||window.performance.webkitNow||window.performance.msNow||window.performance.mozNow||Date.now||function(){return(new Date).getTime()}}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){return setTimeout(function(){var b=window.performance.now();a(b)},16)}}()}(),function(){"use strict";function a(){var a={};this.register=function(b,c){return angular.isObject(b)?angular.extend(a,b):a[b]=c,this},this.$get=["$injector",function(b){return angular.forEach(a,function(c,d){angular.isFunction(c)&&(a[d]=b.invoke(c,null,null,d))}),a}]}angular.module("hc.ngEcs",[]).factory("Entity",["$components",function(a){function b(){var a=(new Date).getUTCMilliseconds();return""+d++ +"_"+a}function c(a){return!1==this instanceof c?new c(a):(this._id=a||b(),void(this.$$listeners={}))}var d=0;return c.prototype.$on=function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]),c.push(b);return function(){var a=c.indexOf(b);-1!==a&&(c[a]=null)}},c.prototype.$emit=function(a){var b,c,d,e=[],f=this,g=Array.prototype.slice.call(arguments,1);for(b=f.$$listeners[a]||e,c=0,d=b.length;d>c;c++)b[c].apply(f,g);return this},c.prototype.$add=function(b,c){if(!b)throw new Error("Can't add component with undefined key.");if(this[b]&&this.$remove(b),c=angular.isDefined(c)?c:{},"$"===b.charAt(0)||"_"===b.charAt(0))return void(this[b]=c);if(a.hasOwnProperty(b)){var d=a[b];"function"==typeof d?c instanceof d?this[b]=c:(this[b]=new d(this),angular.extend(this[b],c)):(this[b]=angular.copy(d),angular.extend(this[b],c))}else this[b]=c;return this.$world.$onComponentAdd(this,b),this},c.prototype.$remove=function(a){return delete this[a],"$"!==a.charAt(0)&&"_"!==a.charAt(0)&&this.$world.$onComponentRemove(this,a),this},c}]).provider("$entities",a).provider("$components",a).provider("$systems",a).service("ngEcs",function(a,b,c,d,e,f,g){function h(a){this.components=d,this.systems=e,this.entities=f,this.families={},angular.forEach(e,function(a,b){this.$s(b,a)}),angular.forEach(f,function(a){this.$e(a)}),this.$playing=!1,this.$fps=60,this.$interval=1,this.$systemsQueue=[],angular.extend(this,a)}function i(a){return a?a.join("::"):"::"}function j(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}function k(a,b){var c=a.indexOf(b);0>c&&a.push(b)}function l(a,b){if(!b)return!0;var c=function(b){return a.hasOwnProperty(b)};return b.every(c)}return h.prototype.constructor=h,h.prototype.$c=function(a,b){this.components[a]=b},h.prototype.$s=function(a,b){this.systems[a]=b,this.$systemsQueue.unshift(b);var c=i(b.$require);b.$family=this.families[c]=this.families[c]||[]},h.prototype.$e=function(a,b){"object"==typeof a&&(b=a,a=null);var c=new g(a);return c.$world=this,Array.isArray(b)?angular.forEach(b,function(a){c.$add(a)}):angular.forEach(b,function(a,b){c.$add(b,a)}),this.entities[c._id]=c,c},h.prototype.$$removeEntity=function(a){a.$world=null,angular.forEach(a,function(b,c){"$"!==c.charAt(0)&&"_"!==c.charAt(0)&&a.$remove(c)}),angular.forEach(this.families,function(b){j(b,a)}),delete this.entities[a._id]},h.prototype.$onComponentAdd=function(a,b){angular.forEach(this.systems,function(c){c.$require&&c.$require.indexOf(b)<0||l(a,c.$require)&&(k(c.$family,a),c.$addEntity&&c.$addEntity(a))})},h.prototype.$onComponentRemove=function(a,b){angular.forEach(this.systems,function(c){!c.$require||c.$require.indexOf(b)<0||(c.$removeEntity&&c.$removeEntity(a),j(c.$family,a))})},h.prototype.$update=function(a){var b=this;a=angular.isUndefined(a)?b.$interval:a;for(var c,d=this.$systemsQueue.length;d--;)c=this.$systemsQueue[d],c.$update&&c.$family.length>0&&c.$update(a)},h.prototype.$render=function(a){var b=this;a=angular.isUndefined(a)?b.$interval:a;for(var c,d=this.$systemsQueue.length;d--;)c=this.$systemsQueue[d],c.$render&&c.$render(a)},h.prototype.$start=function(){function b(){if(e.$playing){for(c=window.performance.now(),h=Math.min(1,(c-f)/1e3),g+=h,d=1/e.$fps;g>d;)g-=d,e.$update(d);a.$applyAsync(function(){e.$render(h)}),f=c,requestAnimationFrame(b)}}if(!this.$playing){this.$playing=!0;var c,d,e=this,f=window.performance.now(),g=0,h=0;requestAnimationFrame(b)}},h.prototype.$stop=function(){this.$playing=!1},new h})}();
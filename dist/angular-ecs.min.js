/**
 * angular-ecs - An ECS framework built for AngularJS
 * @version v0.0.21
 * @link https://github.com/Hypercubed/angular-ecs
 * @author Jayson Harshbarger <>
 * @license 
 */
"use strict";!function(){function t(){var t={};this.register=function(n,e){return angular.isObject(n)?angular.extend(t,n):t[n]=e,this},this.$get=["$injector",function(n){return angular.forEach(t,function(e,i){angular.isFunction(e)&&(t[i]=n.invoke(e,null,null,i))}),t}]}angular.module("hc.ngEcs",[]).provider("$entities",t).provider("$components",t).provider("$systems",t).provider("$families",t)}(),function(){angular.module("hc.ngEcs").factory("Entity",["$components",function(t){function n(){var t=(new Date).getUTCMilliseconds();return""+s++ +"_"+t}function e(t){return!1==this instanceof e?new e(t):(this._id=t||n(),this.$componentAdded=new signals.Signal,this.$componentRemoved=new signals.Signal,void(this.$$signals={}))}function i(n,e,i){if(!t.hasOwnProperty(e))return i;var o=t[e];if(!angular.isFunction(o))throw new TypeError("Component constructor may only be an Object or function");return i instanceof o?i:o.$inject?r(o,n,i):angular.extend(new o(n),i)}function r(t,n,e){var i,r=t.$inject,a=r.length,s=new Array(a);for(i=0;a>i;++i)s[i]=o(n,r[i],e);var c=Object.create(t.prototype||null);return t.apply(c,s),c}function o(t,n,e){return"$parent"===n?t:"$state"===n?e:e[n]}function a(t){return"$"!==t.charAt(0)&&"_"!==t.charAt(0)}var s=0;return e.prototype.$on=function(t,n){var e=this.$$signals[t];return e||(this.$$signals[t]=e=new signals.Signal),e.add(n,this)},e.prototype.$emit=function(t){var n=this.$$signals[t];if(n){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,1);n.dispatch.apply(n,e)}else n.dispatch();return this}},e.prototype.$add=function(t,n){if(!t)throw new Error("Can't add component with undefined key.");return this[t]&&this.$remove(t),n=angular.isDefined(n)?n:{},"$"===t.charAt(0)||"_"===t.charAt(0)?void(this[t]=n):(this[t]=i(this,t,n),this.$componentAdded.dispatch(this,t),this)},e.prototype.$remove=function(t){return a(t)&&this.$componentRemoved.dispatch(this,t),delete this[t],this},e}])}(),function(){function t(n){var e=[];Object.defineProperty(e,"require",{enumerable:!1,writable:!1,value:n}),Object.defineProperty(e,"entityAdded",{enumerable:!1,value:new signals.Signal}),Object.defineProperty(e,"entityRemoved",{enumerable:!1,value:new signals.Signal});for(var i in t.prototype)t.prototype.hasOwnProperty(i)&&Object.defineProperty(e,i,{enumerable:!1,value:t.prototype[i]});return e}t.prototype.isMatch=function(t){return this.require?this.require.every(function(n){return t.hasOwnProperty(n)}):!0},t.prototype.add=function(t){var n=this.indexOf(t);0>n&&(this.push(t),this.entityAdded.dispatch(t))},t.prototype.addIfMatch=function(t){this.isMatch(t)&&this.add(t)},t.prototype.remove=function(t){var n=this.indexOf(t);n>-1&&(this.splice(n,1),this.entityRemoved.dispatch(t))},t.prototype.removeIfMatch=function(t){this.isMatch(t)&&this.remove(t)},t.makeId=function(t){return t?"string"==typeof t?t:t.sort().join("::"):"::"},angular.module("hc.ngEcs").constant("Family",t)}(),function(){angular.module("hc.ngEcs").service("ngEcs",["$rootScope","$log","$timeout","$components","$systems","$entities","$families","Entity","Family",function(t,n,e,i,r,o,a,s,c){function u(){var t=(new Date).getUTCMilliseconds();return""+m++ +"_"+t}function d(n){this.components=i,this.systems=r,this.entities=o,this.families=a,angular.forEach(r,function(t,n){this.$s(n,t)}),angular.forEach(o,function(t){this.$e(t)}),this.$playing=!1,this.$requestId=null,this.$fps=60,this.$interval=1,this.started=new signals.Signal,this.stopped=new signals.Signal,this.updated=new signals.Signal,this.rendered=new signals.Signal,this.rendered.add(function(){t.$applyAsync()},null,-1),angular.extend(this,n)}function p(t,n){if(angular.isArray(n)){var e=n.pop();e.$inject=n,n=e}if(angular.isFunction(n))return n;if("object"!=typeof n)throw new TypeError("Component constructor may only be an Object or function");var i=new Function("return function "+t+"( instance ){ angular.extend(this, instance); }")();return i.prototype=n,i.prototype.constructor=i,i.$inject=["$state"],i}function h(t){angular.forEach(o,function(n){t.addIfMatch(n)})}function f(t,n){angular.forEach(a,function(e){e.require&&n&&e.require.indexOf(n)<0||e.addIfMatch(t)})}function $(t,n){angular.forEach(a,function(e){!e.require||n&&e.require.indexOf(n)<0||e.removeIfMatch(t)})}function l(t){return w.test(Object.prototype.toString.call(t))}var m=0;d.prototype.constructor=d,d.prototype.$c=function(t,n){if("string"!=typeof t)throw new TypeError("A components name is required");return i[t]=p(t,n)},d.prototype.$f=function(t){var n=c.makeId(t),e=a[n];return e?e:(e=a[n]=new c(t),h(e),e)};var y=angular.isDefined;d.prototype.$s=function(t,n){"object"==typeof t&&(n=t,t=u()),r[t]=n;var e=n.$priority||0;return n.$family=this.$f(n.$require),n.$addEntity&&n.$family.entityAdded.add(n.$addEntity,n,e),n.$removeEntity&&n.$family.entityRemoved.add(n.$removeEntity,n,e),this.$$addSystem(r[t]),n},d.prototype.$$addSystem=function(t){var n=t.$priority||0,e=y(t.$update),i=y(t.$updateEach);if(e||i){t.$$updateEach=i?function(t){for(var n=this.$family,e=n.length;e--;)e in n&&this.$updateEach(n[e],t)}:angular.noop;var r;r=i&&e?function(n){t.$family.length>0&&(this.$update(n),this.$$updateEach(n))}.bind(t):e?function(n){t.$family.length>0&&this.$update(n)}.bind(t):t.$$updateEach,y(t.interval)?(t.acc=y(t.acc)?t.acc:0,t.$$update=function(t){this.acc+=t,this.acc>this.interval&&(r(this.interval),this.acc=this.acc-this.interval)}):t.$$update=r,this.updated.add(t.$$update,t,n)}return y(t.$render)&&this.rendered.add(t.$render,t,n),y(t.$renderEach)&&(t.$$renderEach=function(){for(var t=this.$family,n=t.length;n--;)n in t&&this.$renderEach(t[n])},this.rendered.add(t.$$renderEach,t)),y(t.$started)&&this.started.add(t.$started,t,n),y(t.$stopped)&&this.stopped.add(t.$stopped,t,n),y(t.$added)&&t.$added(),this},d.prototype.$$removeSystem=function(t){return"string"==typeof t&&(t=r[key]),y(t.$$update)&&this.updated.remove(t.$$update,t),y(t.$render)&&this.rendered.remove(t.$render,t),y(t.$$renderEach)&&this.rendered.remove(t.$$renderEach,t),y(t.$started)&&this.started.remove(t.$started,t),y(t.$stopped)&&this.stopped.remove(t.$stopped,t),y(t.$removed)&&t.$removed(),this},d.prototype.$e=function(t,n){"object"==typeof t&&(n=t,t=null);var e=new s(t);return e.$world=this,Array.isArray(n)?n.forEach(function(t){e.$add(t)}):angular.forEach(n,function(t,n){e.$add(n,t)}),f(e),e.$componentAdded.add(f,this),e.$componentRemoved.add($,this),o[e._id]=e,e},d.prototype.$$removeEntity=function(t){return t.$world=null,angular.forEach(t,function(n,e){"$"!==e.charAt(0)&&"_"!==e.charAt(0)&&t.$remove(e)}),angular.forEach(a,function(n){n.remove(t)}),t.$componentAdded.dispose(),t.$componentRemoved.dispose(),delete this.entities[t._id],this},d.prototype.$update=function(t){this.updated.dispatch(t||this.$interval)},d.prototype.$render=function(t){this.rendered.dispatch(t||this.$interval)},d.prototype.$runLoop=function(){function t(){if(i.$playing&&!i.$paused){for(n=window.performance.now(),a=Math.min(1,(n-r)/1e3),o+=a,e=1/i.$fps;o>e;)o-=e,i.$update(e);i.$render(a),r=n,i.$requestId=window.requestAnimationFrame(t)}}window.cancelAnimationFrame(this.$requestId);var n,e,i=this,r=window.performance.now(),o=0,a=0;i.$requestId=window.requestAnimationFrame(t)},d.prototype.$start=function(){this.$playing||(this.$playing=!0,this.started.dispatch(),this.$runLoop())},d.prototype.$stop=function(){this.$playing=!1,window.cancelAnimationFrame(this.$requestId),this.stopped.dispatch()},d.prototype.$pause=function(){this.$playing&&(this.$paused=!0)},d.prototype.$unpause=function(){this.$playing&&this.$paused&&(this.$paused=!1,this.$runLoop())};var w=/^\[object (Uint8(Clamped)?)|(Uint16)|(Uint32)|(Int8)|(Int16)|(Int32)|(Float(32)|(64))Array\]$/;return d.prototype.$copyState=function g(t){var n={};for(var e in t)if(t.hasOwnProperty(e)&&"$"!==e.charAt(0)){var i=t[e];!angular.isObject(i)||l(i)||angular.isArray(i)||angular.isDate(i)?"function"!=typeof i&&(n[e]=i):n[e]=g(i)}return n},new d}])}(),function(){window.performance=window.performance||{},window.performance.now=function(){return window.performance.now||window.performance.webkitNow||window.performance.msNow||window.performance.mozNow||Date.now||function(){return(new Date).getTime()}}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(function(){var n=window.performance.now();t(n)},16)}}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)}}(),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=Array.prototype.slice.call(arguments,1),e=this,i=function(){},r=function(){return e.apply(this instanceof i?this:t,n.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r})}();
/**
 * angular-ecs
 * @version v0.0.6 - 2015-03-23
 * @link https://github.com/Hypercubed/angular-ecs
 * @author Jayson Harshbarger <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";function a(){var a={};this.register=function(b,c){return angular.isObject(b)?angular.extend(a,b):a[b]=c,this},this.$get=["$injector",function(b){return angular.forEach(a,function(c,d){angular.isFunction(c)&&(a[d]=b.invoke(c,null,null,d))}),a}]}angular.module("hc.ngEcs",[]).factory("Entity",["$components",function(a){function b(){var a=(new Date).getUTCMilliseconds();return""+d++ +"_"+a}function c(a){return!1==this instanceof c?new c(a):(this._id=a||b(),void(this.$$listeners={}))}var d=0;return c.prototype.$on=function(a,b){var c=this.$$listeners[a];c||(this.$$listeners[a]=c=[]),c.push(b);return function(){var a=c.indexOf(b);-1!==a&&(c[a]=null)}},c.prototype.$emit=function(a){var b,c,d,e=[],f=this,g=Array.prototype.slice.call(arguments,1);for(b=f.$$listeners[a]||e,c=0,d=b.length;d>c;c++)b[c].apply(f,g);return this},c.prototype.$add=function(b,c){if(!b)throw new Error("Can't add component with undefined key.");if(this[b]&&this.$remove(b),c=angular.isDefined(c)?c:{},"$"===b.charAt(0)||"_"===b.charAt(0))return void(this[b]=c);if(a.hasOwnProperty(b)){var d=a[b];"function"==typeof d?c instanceof d?this[b]=c:(this[b]=new d(this),angular.extend(this[b],c)):(this[b]=angular.copy(d),angular.extend(this[b],c)),this[b].$parent=this}else this[b]=c;return this.$world.$onComponentAdd(this,b),this},c.prototype.$remove=function(a){return delete this[a],"$"!==a.charAt(0)&&"_"!==a.charAt(0)&&this.$world.$onComponentRemove(this,a),this},c}]).provider("$entities",a).provider("$components",a).provider("$systems",a).service("ngEcs",function(a,b,c,d,e,f){function g(a){this.components=c,this.systems=d,this.entities=e,this.families={},angular.forEach(d,function(a,b){this.$s(b,a)}),angular.forEach(e,function(a){this.$e(a)}),this.$timer=null,this.$playing=!1,this.$delay=1e3,this.$interval=1,this.$systemsQueue=[],angular.extend(this,a)}function h(a){return a?a.join("::"):"::"}function i(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}function j(a,b){var c=a.indexOf(b);0>c&&a.push(b)}function k(a,b){if(!b)return!0;var c=function(b){return a.hasOwnProperty(b)};return b.every(c)}return g.prototype.constructor=g,g.prototype.$c=function(a,b){this.components[a]=b},g.prototype.$s=function(a,b){this.systems[a]=b,this.$systemsQueue.unshift(b);var c=h(b.$require);b.$family=this.families[c]=this.families[c]||[]},g.prototype.$e=function(a,b){"object"==typeof a&&(b=a,a=null);var c=new f(a);return c.$world=this,Array.isArray(b)?angular.forEach(b,function(a){c.$add(a)}):angular.forEach(b,function(a,b){c.$add(b,a)}),this.entities[c._id]=c,c},g.prototype.$$removeEntity=function(a){a.$world=null,angular.forEach(a,function(b,c){"$"!==c.charAt(0)&&"_"!==c.charAt(0)&&a.$remove(c)}),angular.forEach(this.families,function(b){i(b,a)}),delete this.entities[a._id]},g.prototype.$onComponentAdd=function(a,b){angular.forEach(this.systems,function(c){c.$require&&c.$require.indexOf(b)<0||k(a,c.$require)&&(j(c.$family,a),c.$addEntity&&c.$addEntity(a))})},g.prototype.$onComponentRemove=function(a,b){angular.forEach(this.systems,function(c){!c.$require||c.$require.indexOf(b)<0||(c.$removeEntity&&c.$removeEntity(a),i(c.$family,a))})},g.prototype.$update=function(a){var b=this;a=angular.isUndefined(a)?b.$interval:a;for(var c,d=this.$systemsQueue.length;d--;)c=this.$systemsQueue[d],c.$update&&c.$family.length>0&&c.$update(a)},g.prototype.$start=function(){function a(){c.$update(c.$interval),c.$timer=b(a,c.$delay)}if(!this.$playing){var c=this;c.$playing=!0,a()}},g.prototype.$stop=function(){this.$playing=!1,this.$timer&&b.cancel(this.$timer)},new g})}();
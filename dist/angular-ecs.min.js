/**
 * angular-ecs
 * @version v0.0.11 - 2015-04-29
 * @link https://github.com/Hypercubed/angular-ecs
 * @author Jayson Harshbarger <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";window.performance=window.performance||{},window.performance.now=function(){return window.performance.now||window.performance.webkitNow||window.performance.msNow||window.performance.mozNow||Date.now||function(){return(new Date).getTime()}}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){return setTimeout(function(){var b=window.performance.now();a(b)},16)}}(),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e})}(),function(){"use strict";function a(){var a={};this.register=function(b,c){return angular.isObject(b)?angular.extend(a,b):a[b]=c,this},this.$get=["$injector",function(b){return angular.forEach(a,function(c,d){angular.isFunction(c)&&(a[d]=b.invoke(c,null,null,d))}),a}]}angular.module("hc.ngEcs",[]).provider("$entities",a).provider("$components",a).provider("$systems",a).provider("$families",a)}(),function(){"use strict";angular.module("hc.ngEcs").factory("Entity",function(a){function b(){var a=(new Date).getUTCMilliseconds();return""+e++ +"_"+a}function c(a){return!1==this instanceof c?new c(a):(this._id=a||b(),this.$componentAdded=new signals.Signal,this.$componentRemoved=new signals.Signal,void(this.$$signals={}))}function d(a){return"$"!==a.charAt(0)&&"_"!==a.charAt(0)}var e=0;return c.prototype.$on=function(a,b){var c=this.$$signals[a];return c||(this.$$signals[a]=c=new signals.Signal),c.add(b,this)},c.prototype.$emit=function(a){var b=this.$$signals[a];if(b){if(arguments.length>1){var c=Array.prototype.slice.call(arguments,1);b.dispatch.apply(b,c)}else b.dispatch();return this}},c.prototype.$add=function(b,c){if(!b)throw new Error("Can't add component with undefined key.");if(this[b]&&this.$remove(b),c=angular.isDefined(c)?c:{},"$"===b.charAt(0)||"_"===b.charAt(0))return void(this[b]=c);if(a.hasOwnProperty(b)){var d=a[b];"function"==typeof d?c instanceof d?this[b]=c:(this[b]=new d(this),angular.extend(this[b],c)):(this[b]=angular.copy(d),angular.extend(this[b],c))}else this[b]=c;return this.$componentAdded.dispatch(this,b),this},c.prototype.$remove=function(a){return d(a)&&this.$componentRemoved.dispatch(this,a),delete this[a],this},c})}(),function(){"use strict";function a(b){var c=[];Object.defineProperty(c,"require",{enumerable:!1,value:b}),Object.defineProperty(c,"entityAdded",{enumerable:!1,value:new signals.Signal}),Object.defineProperty(c,"entityRemoved",{enumerable:!1,value:new signals.Signal});for(var d in a.prototype)a.prototype.hasOwnProperty(d)&&Object.defineProperty(c,d,{enumerable:!1,value:a.prototype[d]});return c}a.prototype.isMatch=function(a){return this.require?this.require.every(function(b){return a.hasOwnProperty(b)}):!0},a.prototype.add=function(a){var b=this.indexOf(a);0>b&&(this.push(a),this.entityAdded.dispatch(a))},a.prototype.addIfMatch=function(a){this.isMatch(a)&&this.add(a)},a.prototype.remove=function(a){var b=this.indexOf(a);b>-1&&(this.splice(b,1),this.entityRemoved.dispatch(a))},a.prototype.removeIfMatch=function(a){this.isMatch(a)&&this.remove(a)},a.makeId=function(a){return a?a.sort().join("::"):"::"},angular.module("hc.ngEcs").constant("Family",a)}(),function(){"use strict";angular.module("hc.ngEcs").service("ngEcs",function(a,b,c,d,e,f,g,h,i){function j(a){this.components=d,this.systems=e,this.entities=f,this.families=g,angular.forEach(e,function(a,b){this.$s(b,a)}),angular.forEach(f,function(a){this.$e(a)}),this.$playing=!1,this.$fps=60,this.$interval=1,this.$systemsQueue=[],angular.extend(this,a)}function k(a){var b=i.makeId(a),c=g[b];return c?c:c=g[b]=new i(a)}function l(a,b){angular.forEach(g,function(c){c.require&&b&&c.require.indexOf(b)<0||c.addIfMatch(a)})}function m(a,b){angular.forEach(g,function(c){!c.require||b&&c.require.indexOf(b)<0||c.removeIfMatch(a)})}return j.prototype.constructor=j,j.prototype.$c=function(a,b){d[a]=b},j.prototype.$s=function(a,b){if(e[a]=b,this.$systemsQueue.unshift(b),b.$family=k(b.$require),b.$addEntity&&b.$family.entityAdded.add(b.$addEntity),b.$removeEntity&&b.$family.entityRemoved.add(b.$removeEntity),b.$updateEach){var c=b.$update?b.$update.bind(b):function(){};b.$update=function(a){c(a);for(var d=-1,e=this.$family,f=e.length;++d<f;)b.$updateEach(e[d],a)}}if(angular.isDefined(b.interval)&&angular.isDefined(b.$update)){var d=b.$update.bind(b);b.acc=angular.isDefined(b.acc)?b.acc:0,b.$update=function(a){this.acc+=a,this.acc>this.interval&&(d(a),this.acc=this.acc-this.interval)}}return b},j.prototype.$e=function(a,b){"object"==typeof a&&(b=a,a=null);var c=new h(a);return c.$world=this,Array.isArray(b)?b.forEach(function(a){c.$add(a)}):angular.forEach(b,function(a,b){c.$add(b,a)}),l(c),c.$componentAdded.add(l,this),c.$componentRemoved.add(m,this),f[c._id]=c,c},j.prototype.$$removeEntity=function(a){a.$world=null,angular.forEach(a,function(b,c){"$"!==c.charAt(0)&&"_"!==c.charAt(0)&&a.$remove(c)}),angular.forEach(g,function(b){b.remove(a)}),a.$componentAdded.dispose(),a.$componentRemoved.dispose(),delete this.entities[a._id]},j.prototype.$update=function(a){a=angular.isUndefined(a)?this.$interval:a;for(var b,c=this.$systemsQueue,d=c.length;d--;)b=c[d],b.$update&&b.$family.length>0&&b.$update(a)},j.prototype.$render=function(a){a=angular.isUndefined(a)?this.$interval:a;for(var b,c=this.$systemsQueue,d=c.length;d--;)b=c[d],b.$render&&b.$render(a)},j.prototype.$start=function(){function b(){if(e.$playing){for(c=window.performance.now(),h=Math.min(1,(c-f)/1e3),g+=h,d=1/e.$fps;g>d;)g-=d,e.$update(d);a.$applyAsync(function(){e.$render(h)}),f=c,window.requestAnimationFrame(b)}}if(!this.$playing){this.$playing=!0;var c,d,e=this,f=window.performance.now(),g=0,h=0;window.requestAnimationFrame(b)}},j.prototype.$stop=function(){this.$playing=!1},new j})}();
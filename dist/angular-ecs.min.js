/**
 * angular-ecs
 * @version v0.0.11 - 2015-04-29
 * @link https://github.com/Hypercubed/angular-ecs
 * @author Jayson Harshbarger <>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(){"use strict";window.performance=window.performance||{},window.performance.now=function(){return window.performance.now||window.performance.webkitNow||window.performance.msNow||window.performance.mozNow||Date.now||function(){return(new Date).getTime()}}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){return setTimeout(function(){var b=window.performance.now();a(b)},16)}}(),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e})}(),function(){"use strict";function a(){var a={};this.register=function(b,c){return angular.isObject(b)?angular.extend(a,b):a[b]=c,this},this.$get=["$injector",function(b){return angular.forEach(a,function(c,d){angular.isFunction(c)&&(a[d]=b.invoke(c,null,null,d))}),a}]}angular.module("hc.ngEcs",[]).provider("$entities",a).provider("$components",a).provider("$systems",a).provider("$families",a)}(),function(){"use strict";angular.module("hc.ngEcs").factory("Entity",function(a){function b(){var a=(new Date).getUTCMilliseconds();return""+e++ +"_"+a}function c(a){return!1==this instanceof c?new c(a):(this._id=a||b(),this.$componentAdded=new signals.Signal,this.$componentRemoved=new signals.Signal,void(this.$$signals={}))}function d(a){return"$"!==a.charAt(0)&&"_"!==a.charAt(0)}var e=0;return c.prototype.$on=function(a,b){var c=this.$$signals[a];return c||(this.$$signals[a]=c=new signals.Signal),c.add(b,this)},c.prototype.$emit=function(a){var b=this.$$signals[a];if(b){if(arguments.length>1){var c=Array.prototype.slice.call(arguments,1);b.dispatch.apply(b,c)}else b.dispatch();return this}},c.prototype.$add=function(b,c){if(!b)throw new Error("Can't add component with undefined key.");if(this[b]&&this.$remove(b),c=angular.isDefined(c)?c:{},"$"===b.charAt(0)||"_"===b.charAt(0))return void(this[b]=c);if(a.hasOwnProperty(b)){var d=a[b];"function"==typeof d?c instanceof d?this[b]=c:(this[b]=new d(this),angular.extend(this[b],c)):(this[b]=angular.copy(d),angular.extend(this[b],c))}else this[b]=c;return this.$componentAdded.dispatch(this,b),this},c.prototype.$remove=function(a){return d(a)&&this.$componentRemoved.dispatch(this,a),delete this[a],this},c})}(),function(){"use strict";angular.module("hc.ngEcs").service("ngEcs",function(a,b,c,d,e,f,g,h){function i(a){this.components=d,this.systems=e,this.entities=f,this.families=g,angular.forEach(e,function(a,b){this.$s(b,a)}),angular.forEach(f,function(a){this.$e(a)}),this.$playing=!1,this.$fps=60,this.$interval=1,this.$systemsQueue=[],angular.extend(this,a)}function j(a){return a?a.join("::"):"::"}function k(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)}function l(a,b){var c=a.indexOf(b);0>c&&a.push(b)}function m(a,b){if(!b)return!0;var c=function(b){return a.hasOwnProperty(b)};return b.every(c)}function n(a,b){angular.forEach(e,function(c){c.$require&&b&&c.$require.indexOf(b)<0||m(a,c.$require)&&(l(c.$family,a),c.$addEntity&&c.$addEntity(a))})}function o(a,b){angular.forEach(e,function(c){!c.$require||b&&c.$require.indexOf(b)<0||m(a,c.$require)&&(c.$removeEntity&&c.$removeEntity(a),k(c.$family,a))})}return i.prototype.constructor=i,i.prototype.$c=function(a,b){d[a]=b},i.prototype.$s=function(a,b){e[a]=b,this.$systemsQueue.unshift(b);var c=j(b.$require);if(b.$family=this.families[c]=this.families[c]||[],b.$updateEach){var d=b.$update?b.$update.bind(b):function(){};b.$update=function(a){d(a);for(var c=-1,e=this.$family,f=e.length;++c<f;)b.$updateEach(e[c],a)}}if(angular.isDefined(b.interval)&&angular.isDefined(b.$update)){var f=b.$update.bind(b);b.acc=angular.isDefined(b.acc)?b.acc:0,b.$update=function(a){this.acc+=a,this.acc>this.interval&&(f(a),this.acc=this.acc-this.interval)}}return b},i.prototype.$e=function(a,b){"object"==typeof a&&(b=a,a=null);var c=new h(a);return c.$world=this,Array.isArray(b)?b.forEach(function(a){c.$add(a)}):angular.forEach(b,function(a,b){c.$add(b,a)}),n(c),c.$componentAdded.add(n,this),c.$componentRemoved.add(o,this),f[c._id]=c,c},i.prototype.$$removeEntity=function(a){a.$world=null,angular.forEach(a,function(b,c){"$"!==c.charAt(0)&&"_"!==c.charAt(0)&&a.$remove(c)}),angular.forEach(g,function(b){k(b,a)}),delete this.entities[a._id]},i.prototype.$update=function(a){a=angular.isUndefined(a)?this.$interval:a;for(var b,c=this.$systemsQueue,d=c.length;d--;)b=c[d],b.$update&&b.$family.length>0&&b.$update(a)},i.prototype.$render=function(a){a=angular.isUndefined(a)?this.$interval:a;for(var b,c=this.$systemsQueue,d=c.length;d--;)b=c[d],b.$render&&b.$render(a)},i.prototype.$start=function(){function b(){if(e.$playing){for(c=window.performance.now(),h=Math.min(1,(c-f)/1e3),g+=h,d=1/e.$fps;g>d;)g-=d,e.$update(d);a.$applyAsync(function(){e.$render(h)}),f=c,window.requestAnimationFrame(b)}}if(!this.$playing){this.$playing=!0;var c,d,e=this,f=window.performance.now(),g=0,h=0;window.requestAnimationFrame(b)}},i.prototype.$stop=function(){this.$playing=!1},new i})}();
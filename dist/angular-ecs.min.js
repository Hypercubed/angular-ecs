/**
 * angular-ecs - An ECS framework built for AngularJS
 * @version v0.0.20
 * @link https://github.com/Hypercubed/angular-ecs
 * @author Jayson Harshbarger <>
 * @license 
 */
"use strict";!function(){function t(){var t={};this.register=function(e,n){return angular.isObject(e)?angular.extend(t,e):t[e]=n,this},this.$get=["$injector",function(e){return angular.forEach(t,function(n,i){angular.isFunction(n)&&(t[i]=e.invoke(n,null,null,i))}),t}]}angular.module("hc.ngEcs",[]).provider("$entities",t).provider("$components",t).provider("$systems",t).provider("$families",t)}(),function(){angular.module("hc.ngEcs").factory("Entity",["$components",function(t){function e(){var t=(new Date).getUTCMilliseconds();return""+s++ +"_"+t}function n(t){return!1==this instanceof n?new n(t):(this._id=t||e(),this.$componentAdded=new signals.Signal,this.$componentRemoved=new signals.Signal,void(this.$$signals={}))}function i(e,n,i){if(!t.hasOwnProperty(n))return i;var o=t[n];if(!angular.isFunction(o))throw new TypeError("Component constructor may only be an Object or function");return i instanceof o?i:o.$inject?r(o,e,i):angular.extend(new o(e),i)}function r(t,e,n){var i,r=t.$inject,a=r.length,s=new Array(a);for(i=0;a>i;++i)s[i]=o(e,r[i],n);var c=Object.create(t.prototype||null);return t.apply(c,s),c}function o(t,e,n){return"$parent"===e?t:"$state"===e?n:n[e]}function a(t){return"$"!==t.charAt(0)&&"_"!==t.charAt(0)}var s=0;return n.prototype.$on=function(t,e){var n=this.$$signals[t];return n||(this.$$signals[t]=n=new signals.Signal),n.add(e,this)},n.prototype.$emit=function(t){var e=this.$$signals[t];if(e){if(arguments.length>1){var n=Array.prototype.slice.call(arguments,1);e.dispatch.apply(e,n)}else e.dispatch();return this}},n.prototype.$add=function(t,e){if(!t)throw new Error("Can't add component with undefined key.");return this[t]&&this.$remove(t),e=angular.isDefined(e)?e:{},"$"===t.charAt(0)||"_"===t.charAt(0)?void(this[t]=e):(this[t]=i(this,t,e),this.$componentAdded.dispatch(this,t),this)},n.prototype.$remove=function(t){return a(t)&&this.$componentRemoved.dispatch(this,t),delete this[t],this},n}])}(),function(){function t(e){var n=[];Object.defineProperty(n,"require",{enumerable:!1,writable:!1,value:e}),Object.defineProperty(n,"entityAdded",{enumerable:!1,value:new signals.Signal}),Object.defineProperty(n,"entityRemoved",{enumerable:!1,value:new signals.Signal});for(var i in t.prototype)t.prototype.hasOwnProperty(i)&&Object.defineProperty(n,i,{enumerable:!1,value:t.prototype[i]});return n}t.prototype.isMatch=function(t){return this.require?this.require.every(function(e){return t.hasOwnProperty(e)}):!0},t.prototype.add=function(t){var e=this.indexOf(t);0>e&&(this.push(t),this.entityAdded.dispatch(t))},t.prototype.addIfMatch=function(t){this.isMatch(t)&&this.add(t)},t.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&(this.splice(e,1),this.entityRemoved.dispatch(t))},t.prototype.removeIfMatch=function(t){this.isMatch(t)&&this.remove(t)},t.makeId=function(t){return t?"string"==typeof t?t:t.sort().join("::"):"::"},angular.module("hc.ngEcs").constant("Family",t)}(),function(){angular.module("hc.ngEcs").service("ngEcs",["$rootScope","$log","$timeout","$components","$systems","$entities","$families","Entity","Family",function(t,e,n,i,r,o,a,s,c){function d(){var t=(new Date).getUTCMilliseconds();return""+m++ +"_"+t}function u(e){this.components=i,this.systems=r,this.entities=o,this.families=a,angular.forEach(r,function(t,e){this.$s(e,t)}),angular.forEach(o,function(t){this.$e(t)}),this.$playing=!1,this.$requestId=null,this.$fps=60,this.$interval=1,this.started=new signals.Signal,this.stopped=new signals.Signal,this.updated=new signals.Signal,this.rendered=new signals.Signal,this.rendered.add(function(){t.$applyAsync()},null,-1),angular.extend(this,e)}function p(t,e){if(angular.isArray(e)){var n=e.pop();n.$inject=e,e=n}if(angular.isFunction(e))return e;if("object"!=typeof e)throw new TypeError("Component constructor may only be an Object or function");var i=new Function("return function "+t+"( instance ){ angular.extend(this, instance); }")();return i.prototype=e,i.prototype.constructor=i,i.$inject=["$state"],i}function h(t){angular.forEach(o,function(e){t.addIfMatch(e)})}function $(t,e){angular.forEach(a,function(n){n.require&&e&&n.require.indexOf(e)<0||n.addIfMatch(t)})}function f(t,e){angular.forEach(a,function(n){!n.require||e&&n.require.indexOf(e)<0||n.removeIfMatch(t)})}function l(t){return w.test(Object.prototype.toString.call(t))}var m=0;u.prototype.constructor=u,u.prototype.$c=function(t,e){if("string"!=typeof t)throw new TypeError("A components name is required");return i[t]=p(t,e)},u.prototype.$f=function(t){var e=c.makeId(t),n=a[e];return n?n:(n=a[e]=new c(t),h(n),n)};var y=angular.isDefined;u.prototype.$s=function(t,e){"object"==typeof t&&(e=t,t=d()),r[t]=e;var n=e.$priority||0;return e.$family=this.$f(e.$require),e.$addEntity&&e.$family.entityAdded.add(e.$addEntity,e,n),e.$removeEntity&&e.$family.entityRemoved.add(e.$removeEntity,e,n),this.$$addSystem(r[t]),e},u.prototype.$$addSystem=function(t){var e=t.$priority||0;return y(t.$update)&&(y(t.interval)?(t.acc=y(t.acc)?t.acc:0,t.$$update=function(e){this.acc+=e,this.acc>this.interval&&(t.$family.length>0&&this.$update(this.interval),this.acc=this.acc-this.interval)}):t.$$update=function(e){t.$family.length>0&&this.$update(e)},this.updated.add(t.$$update,t,e)),y(t.$updateEach)&&(t.$$updateEach=function(t){for(var e=this.$family,n=e.length;n--;)n in e&&this.$updateEach(e[n],t)},this.updated.add(t.$$updateEach,t,e)),y(t.$render)&&this.rendered.add(t.$render,t,e),y(t.$renderEach)&&(t.$$renderEach=function(){for(var t=this.$family,e=t.length;e--;)e in t&&this.$renderEach(t[e])},this.rendered.add(t.$$renderEach,t)),y(t.$started)&&this.started.add(t.$started,t,e),y(t.$stopped)&&this.stopped.add(t.$stopped,t,e),y(t.$added)&&t.$added(),this},u.prototype.$$removeSystem=function(t){return"string"==typeof t&&(t=r[key]),y(t.$$update)&&this.updated.remove(t.$$update,t),y(t.$$updateEach)&&this.updated.remove(t.$$updateEach,t),y(t.$render)&&this.rendered.remove(t.$render,t),y(t.$$renderEach)&&this.rendered.remove(t.$$renderEach,t),y(t.$started)&&this.started.remove(t.$started,t),y(t.$stopped)&&this.stopped.remove(t.$stopped,t),y(t.$removed)&&t.$removed(),this},u.prototype.$e=function(t,e){"object"==typeof t&&(e=t,t=null);var n=new s(t);return n.$world=this,Array.isArray(e)?e.forEach(function(t){n.$add(t)}):angular.forEach(e,function(t,e){n.$add(e,t)}),$(n),n.$componentAdded.add($,this),n.$componentRemoved.add(f,this),o[n._id]=n,n},u.prototype.$$removeEntity=function(t){return t.$world=null,angular.forEach(t,function(e,n){"$"!==n.charAt(0)&&"_"!==n.charAt(0)&&t.$remove(n)}),angular.forEach(a,function(e){e.remove(t)}),t.$componentAdded.dispose(),t.$componentRemoved.dispose(),delete this.entities[t._id],this},u.prototype.$update=function(t){this.updated.dispatch(t||this.$interval)},u.prototype.$render=function(t){this.rendered.dispatch(t||this.$interval)},u.prototype.$runLoop=function(){function t(){if(i.$playing&&!i.$paused){for(e=window.performance.now(),a=Math.min(1,(e-r)/1e3),o+=a,n=1/i.$fps;o>n;)o-=n,i.$update(n);i.$render(a),r=e,i.$requestId=window.requestAnimationFrame(t)}}window.cancelAnimationFrame(this.$requestId);var e,n,i=this,r=window.performance.now(),o=0,a=0;i.$requestId=window.requestAnimationFrame(t)},u.prototype.$start=function(){this.$playing||(this.$playing=!0,this.started.dispatch(),this.$runLoop())},u.prototype.$stop=function(){this.$playing=!1,window.cancelAnimationFrame(this.$requestId),this.stopped.dispatch()},u.prototype.$pause=function(){this.$playing&&(this.$paused=!0)},u.prototype.$unpause=function(){this.$playing&&this.$paused&&(this.$paused=!1,this.$runLoop())};var w=/^\[object (Uint8(Clamped)?)|(Uint16)|(Uint32)|(Int8)|(Int16)|(Int32)|(Float(32)|(64))Array\]$/;return u.prototype.$copyState=function g(t){var e={};for(var n in t)if(t.hasOwnProperty(n)&&"$"!==n.charAt(0)){var i=t[n];!angular.isObject(i)||l(i)||angular.isArray(i)||angular.isDate(i)?"function"!=typeof i&&(e[n]=i):e[n]=g(i)}return e},new u}])}(),function(){window.performance=window.performance||{},window.performance.now=function(){return window.performance.now||window.performance.webkitNow||window.performance.msNow||window.performance.mozNow||Date.now||function(){return(new Date).getTime()}}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(function(){var e=window.performance.now();t(e)},16)}}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)}}(),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r})}();